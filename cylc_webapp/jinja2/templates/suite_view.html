<!DOCTYPE html>

<html lang="en-us">

    <head>
        <title>Capstone</title>
        <meta charset="utf-8">
        
        <!--Local Style Sheet-->
        <link href="{{ static('styles.css') }}" rel="stylesheet" type="text/css" />
        <!--Bootstrap-->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
        
        <script src="https://code.jquery.com/jquery-latest.js"> </script>
        <script>
            $(document).ready(function() {
                refreshData();
            });
            
            function refreshData() {
                var url = 'webapp'; 
                $('#refreshWrapper').load(url + ' #refreshableData', function(){
                    setTimeout(refreshData, 1000);
                }); 
            }
        </script> 
    </head>
    
    <!--Content-->
    <body>
        <div class="center">
            <h1 class="display-4"> Cylc Suite Information</h1>    
                
            <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #e3f2fd;">
                <a class="navbar-brand" href="#">{{suite}}</a>
                
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav">
                        <li class="nav-item"> <a href="#" class="nav-link dropdown-toggle">File</a> </li>
                        <li class="nav-item"> <a href="#" class="nav-link dropdown-toggle">View</a> </li>
                        <li class="nav-item"> <a href="#" class="nav-link dropdown-toggle">Control</a> </li>
                        <li class="nav-item"> <a href="#" class="nav-link dropdown-toggle">Suite</a> </li>
                        <li class="nav-item"> <a href="#" class="nav-link dropdown-toggle">Help</a> </li>
                    </ul>
                </div>
            </nav>
            
            <!--TODO: add more states: running, runahead-->
            {% macro displayStateColor(state = "") -%}
		        {% if state == "succeeded" %}
		            <div class="circle" style="background-color: green"> </div>
    		    {% elif state == "queued" %}
    		        <div class="circle" style="background-color: yellow"> </div>
    		    {% elif state == "waiting" %}
    		        <div class="circle" style="background-color: blue"> </div>
    		    {% elif state == "ready" %}
    		        <div class="circle" style="background-color: brown"> </div>
    		    {% elif state == "held" %}
    		        <div class="circle" style="background-color: pink"> </div>
    		    {% elif state == "failed" %}
    		        <div class="circle" style="background-color: red"> </div>
    		    {% else %}
    		        <!--TODO: need to make this display the color of the status of the whole group-->
    		        <div class="circle" style="background-color: white; border: 1px solid gray"> </div>
    		    {% endif %}
            {%- endmacro %}
    
        
            <div id="refreshWrapper">
                <div id = "refreshableData">
                    <table id="JobDisplay" class="table table-striped">
                        <thead class="thead-dark">
                            <th>task</th>
                            <th>label</th>
                        	<th>state</th>
                        	<th>host</th>
                        	<th>latest message</th>
                        	<th>job system</th>
                        	<th>job ID</th>
                        	<th>T-submit</th>
                        	<th>T-start</th>
                        	<th>T-finish</th>
                        	<th>dT-mean</th>
                    	</thead>
                    	
                        {% for item in data %}
                    	<tr>
                    		<td>
                    		    {% for i in range(item['indent']) %}    
                    		        &emsp;&emsp;
                    		    {% endfor %}
                                <!--TODO: display "expanded" arrow for non cycle point groups simply check to see if is_group is True and indent != 0-->
                    		    {{ displayStateColor(item["state"])}}
                                {{ item["name"] }}
                    		</td>
                    		<td>{{ item["label"] }}</td>
                    		<td>{{ item["state"] }}</td>
                    		<td>{{ item["host"] }}</td>
                    		<td>{{ item["latest_message"] }}</td>
                    		<td>{{ item["batch_sys_name"] }}</td>
                    		<td>{{ item["submit_method_id"] }}</td>
                    		<td>{{ item["submitted_time_string"] }}</td>
                    		<td>{{ item["started_time_string"] }}</td>
                    		<td>{{ item["finished_time_string"] }}</td>
                    		<td>{{ item["mean_elapsed_time"] }}</td>
                    	</tr>
                        {% endfor %}
                    </table>
                </div> <!--refreshableData-->
            </div> <!--refreshWrapper-->    
        </div> <!--center-->
    </body>
</html>